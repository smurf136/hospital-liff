<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Result</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  </head>
  <body>
    <h1 id="profile"></h1>
    <h2 id="title"></h2>
    <p id="desc"></p>
    <p id="error"></p>
    <button onclick="send()">Send to LINE</button>
    <button onclick="getProfile()">getProfile</button>
    <button onclick="close()">close</button>

    <script>
      const results = {
        A: {
          title: "Result A",
          message: "You selected A – static result",
        },
        B: {
          title: "Result B",
          message: "You selected B – static result",
        },
        C: {
          title: "Result C",
          message: "You selected C – static result",
        },
      };

      const params = new URLSearchParams(location.search);
      const c = params.get("c");

      document.getElementById("title").innerText = results[c].title;
      document.getElementById("desc").innerText = results[c].message;

      async function close() {
        liff.closeWindow();
      }

      async function getProfile() {
        liff
          .init({
            liffId: "2008942006-tbQFVRAB", // Use own liffId
          })
          .then(() => {
            liff
              .getProfile()
              .then((e) => (document.getElementById("profile").innerText = e));
            // start to use LIFF's api
          })
          .catch((err) => {
            console.log(err);
            document.getElementById("profile").innerText = `err: ${err}`;
          });
        // try {
        //   await liff.init({ liffId: "2008942006-tbQFVRAB" });

        //     await
        // } catch (e) {
        //   document.getElementById("profile").innerText = `err: ${e}`;
        // }
      }

      async function send() {
        try {
          await liff.init({ liffId: "2008942006-tbQFVRAB" });
          if (liff.isLoggedIn()) {
            var test = await liff.sendMessages([
              {
                type: "text",
                text: results[c].message,
              },
            ]);

            document.getElementById("error").innerText = `test: ${test}`;
            liff.closeWindow();
          } else {
            liff.login();
          }
        } catch (e) {
          document.getElementById("error").innerText = e;
        }
      }
    </script>
  </body>
</html>
